@model List<Master40.Models.LogMessage>

@{
    ViewBag.Title = "title";
    Layout = "_Layout";
    int LineNumber = 0;
}


<script>
    function submitform() {
        $('form').submit();
    }
</script>
<hr/>
<div class="row">
    <div class="col-md-4 col-xs-4">
        <div class="col-md-12">
            <h2>MRP </h2>
            <p>
                Container to Process the MRP Run and Show the Results.
            </p>
            <p><a class="btn btn-default btn-block" href="~/Mrp/MrpProcessing">run the whole MRP process</a>
            </p>
            <div>
                <P>Iterate through each step</P>
                <p><a class="btn btn-default btn-block" href="#" onclick="startBackward()">Schedule backward</a>
                </p>
                <p><a class="btn btn-default btn-block" href="~/Mrp/MrpForward">Schedule forward</a>
                </p>
                <p><a class="btn btn-default btn-block" href="~/Mrp/CapacityPlanning">Plan capacities</a>
                </p>
                <p><a class="btn btn-default btn-block" href="~/Mrp/MrpGifflerThompson">Giffler-Thompson</a>
                </p>
            </div>
            <div>
                <p><a class="btn btn-default btn-block" href="~/MRP/Simulate">Simulate</a>
                </p>
            </div>

                <h4>Processing State:</h4>
                <div id="MessageDisplay" class=""></div>
        </div>
    </div>    
    <div class="col-xs-8 col-md-8">
        <div class="ProductionGantt" id="ProductionGantt" />
    </div>
</div>
    <div class="row">
        <div class="col-md-8 pull-right" id="ProductionChart">
        </div>
        <div class="col-md-4 pull-left">
            &nbsp;
            <!--
            <h2>Result</h2>
            @foreach (var item in Model)
            {
                <div class="alert alert-@item.MessageType.ToString()">
                    @{ LineNumber = LineNumber + 1; }
                    <strong> @LineNumber.ToString() :</strong> @Html.DisplayFor(modelItem => item.Message)
                </div>
            }
            -->
        </div>
    </div>
    <script>
        var processingProxy = $.connection.hub.createHubProxy("ProcessingHub");
        processingProxy.on("clientListener", function (msg) {

            if (msg == "MrpProcessingComplete") {
                $.ajax({
                    url: "Mrp/ReloadGantt",
                    context: document.body,
                    beforeSend: function () {
                        $('#ajax-busy').show();
                    },
                    success: function (msg) {
                        $('#ajax-busy').hide();

                    },
                    error: function () {
                        $(document).ajaxError(function (xhr, ajaxOptions, thrownError) {
                            alert('status: ' +
                                ajaxOptions.status +
                                '-' +
                                ajaxOptions.statusText +
                                ' \n' +
                                'error:\n' +
                                ajaxOptions.responseText);
                        });
                    }
                }).done(function (data) { $('#ProductionGantt').html(data); });

                $.ajax({
                    url: "Mrp/ReloadChart",
                    context: document.body,
                    beforeSend: function () {
                        $('#ajax-busy').show();
                    },
                    success: function (msg) {
                        $('#ajax-busy').hide();

                    },
                    error: function () {
                        $(document).ajaxError(function (xhr, ajaxOptions, thrownError) {
                            alert('status: ' +
                                ajaxOptions.status +
                                '-' +
                                ajaxOptions.statusText +
                                ' \n' +
                                'error:\n' +
                                ajaxOptions.responseText);
                        });
                    }
                }).done(function (data) { $('#ProductionChart').html(data); });
                $("#MessageDisplay").append('<div class="alert alert-info">Completed Processing</div>');
            } else {
                $("#MessageDisplay").append(msg);
            }
        });

        // Processing Hub is loaded
        $.connection.hub.start().done(function () {
            processingProxy.invoke('SystemReady');
            $('#ajax-busy').hide();
        })


        // Start Backward Scheduler
        function startBackward() {
            processingProxy.invoke('StartBackwardScheduler');
            $('#ajax-busy').show();
        }


        // Block Interactions
        $(document).ready(function () {
            $('#ajax-busy').show();
            $('#main').removeClass("container").addClass("container-fluid");
        });

    </script>
